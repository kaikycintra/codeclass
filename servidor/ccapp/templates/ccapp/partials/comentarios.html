{% load extras %}

<div class="row row-cols-1" id="caixa-comentarios" hx-target="this" hx-swap="outerHTML">
    <p class="fs-1">Comentários</p>

    <div class="card mb-3">
        <div class="card-body">
            <form hx-post="{% url 'ccapp:postar_comentario' aula.id %}" hx-target="#caixa-comentarios">
                {% csrf_token %}
                <textarea class="form-control" name="texto" placeholder="Escreva seu comentário..." required></textarea>
                <button type="submit" class="btn btn-primary mt-2">Enviar</button>
            </form>
        </div>
    </div>

    {% for comentario in comentarios %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <strong>{{ comentario.user.username }}</strong>
                    <small class="text-muted">{{ comentario.data|date:"d/m/Y" }}</small>
                </div>

                <p class="mt-2">{{ comentario.texto }}</p>
                <div class="d-flex justify-content-between align-items-center">
                    {% include "ccapp/partials/like.html" with comentario=comentario %}

                    <!--Nota: esta parte de responder comentário é apenas um placeholder-->
                    <button class="btn btn-sm btn-outline-secondary rounded-5" disabled>Responder</button>
                </div>

                {% for resposta in comentario.respostas.all %}
                <div class="card mt-3 ms-3 border-start ps-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <strong>{{ resposta.user.username }}</strong>
                            <small class="text-muted"> {{ resposta.data }}</small>
                        </div>
                        <p class="mt-2">{{ resposta.texto }}</p>
                        <div class="d-flex justify-content-between align-items-center">{% csrf_token %}
                            <div class="d-flex align-items-center">
                                {% include "ccapp/partials/like.html" with comentario=resposta %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    {% empty %}
        <p> Sem comentários </p>
    {% endfor %}
</div>